;******************** PASS-2 *****************************;[STARTUP.ASM#1183]
b equ byte ptr;[STARTUP.ASM#18]
w equ <word ptr>;[STARTUP.ASM#19]
d equ <dword ptr>;[STARTUP.ASM#20]
o equ <offset>;[STARTUP.ASM#21]
OS32 segment use16;[STARTUP.ASM#23]
ORG 0100h;[STARTUP.ASM#24]
assume cs:OS32,es:OS32,ss:OS32;[STARTUP.ASM#25]
START:;[STARTUP.ASM#27]
JMP DEBCOM;[STARTUP.ASM#30]
DBNomVer equ 3 +600h;[STARTUP.ASM#35]
DWOct_Sec equ 11+600h;[STARTUP.ASM#36]
DBSec_Clu equ 13+600h;[STARTUP.ASM#37]
DWSec_Res equ 14+600h;[STARTUP.ASM#38]
DBNb_FAT equ 16+600h;[STARTUP.ASM#39]
DWE_Rac equ 17+600h;[STARTUP.ASM#40]
DWSec_Vol equ 19+600h;[STARTUP.ASM#41]
DBDesc_Supp equ 21+600h;[STARTUP.ASM#42]
DWSec_FAT equ 22+600h;[STARTUP.ASM#43]
DWSec_Pis equ 24+600h;[STARTUP.ASM#44]
DWNb_tet equ 26+600h;[STARTUP.ASM#45]
DDDis_mass equ 28+600h;[STARTUP.ASM#46]
DDSec_Vol2 equ 32+600h;[STARTUP.ASM#47]
DDSec_FAT2 equ 36+600h;[STARTUP.ASM#49]
DDRoot_Clu equ 44+600h;[STARTUP.ASM#52]
DBDrive equ 64+600h;[STARTUP.ASM#57]
DDPosClu equ 90+600h;[STARTUP.ASM#67]
DDPosRac equ 94+600h;[STARTUP.ASM#68]
DDPosFAT equ 98+600h;[STARTUP.ASM#69]
DBInt13_Size equ 102+600h;[STARTUP.ASM#72]
DBInt13_Reserved equ 103+600h;[STARTUP.ASM#73]
DWInt13_NbrSector equ 104+600h;[STARTUP.ASM#74]
DWInt13_Offset equ 106+600h;[STARTUP.ASM#75]
DWInt13_Segment equ 108+600h;[STARTUP.ASM#76]
DDInt13_Sector equ 110+600h;[STARTUP.ASM#77]
DDInt13_SectorHigh equ 114+600h;[STARTUP.ASM#78]
INVIT:;[STARTUP.ASM#80]
DB 'dans STARTUP',13,10,0;[STARTUP.ASM#80]
old_sector_FAT equ 600h;[STARTUP.ASM#85]
DEBCOM:;[STARTUP.ASM#90]
MOV AX,FIN_LIMIT_512;[STARTUP.ASM#92]
CMP AX,512;[STARTUP.ASM#93]
JB NEAR LIMIT_OK;[STARTUP.ASM#94]
MOV AH,0EH;[STARTUP.ASM#95]
XOR BX,BX;[STARTUP.ASM#96]
MOV AL,'E';[STARTUP.ASM#97]
INT 10H;[STARTUP.ASM#98]
JMP $;[STARTUP.ASM#99]
LIMIT_OK:;[STARTUP.ASM#100]
MOV SP,0800H;[STARTUP.ASM#103]
MOV DI,2800H;[STARTUP.ASM#104]
MOV SI,7C00H;[STARTUP.ASM#105]
MOV CX,256;[STARTUP.ASM#106]
REP MOVSW;[STARTUP.ASM#107]
DB 0EAH;[STARTUP.ASM#108]
DW NEWCODE-100H;[STARTUP.ASM#109]
DW 280H;[STARTUP.ASM#110]
NEWCODE:;[STARTUP.ASM#111]
XOR AX,AX;[STARTUP.ASM#112]
MOV FS,AX;[STARTUP.ASM#113]
MOV [FS:OLD_SECTOR_FAT],D -1;[STARTUP.ASM#116]
MOV BX,280H;[STARTUP.ASM#117]
MOV DH,[FS:DBSEC_CLU];[STARTUP.ASM#118]
MOVZX CX,DH;[STARTUP.ASM#119]
SHL CX,5;[STARTUP.ASM#120]
LECSUITE:;[STARTUP.ASM#121]
CALL ADDRCLU;[STARTUP.ASM#122]
MOV ES,BX;[STARTUP.ASM#123]
CALL LECSEC;[STARTUP.ASM#124]
ADD BX,CX;[STARTUP.ASM#125]
CALL CLUSUIVANT;[STARTUP.ASM#126]
CMP BX,300H;[STARTUP.ASM#127]
JAE NEAR SUITECODE;[STARTUP.ASM#128]
JMP LECSUITE;[STARTUP.ASM#129]
ADDRCLU:;[STARTUP.ASM#133]
PUSH EDX;[STARTUP.ASM#134]
MOVZX EAX,[FS:B +DBSEC_CLU];[STARTUP.ASM#135]
MUL [FS:D +DDROOT_CLU];[STARTUP.ASM#136]
ADD EAX,[FS:DDPOSCLU];[STARTUP.ASM#137]
POP EDX;[STARTUP.ASM#138]
RET;[STARTUP.ASM#139]
CLUSUIVANT:;[STARTUP.ASM#142]
PUSHAD;[STARTUP.ASM#143]
PUSH ES;[STARTUP.ASM#144]
MOV AX,100H;[STARTUP.ASM#146]
MOV ES,AX;[STARTUP.ASM#147]
MOV DH,1;[STARTUP.ASM#148]
MOV EBX,[FS:DDROOT_CLU];[STARTUP.ASM#150]
TEST [FS:B +DBDRIVE],80H;[STARTUP.ASM#151]
JZ NEAR CLUFAT12;[STARTUP.ASM#152]
OR [FS:W +DWE_RAC],0;[STARTUP.ASM#153]
JNZ NEAR CLUFAT16;[STARTUP.ASM#154]
CLUFAT32:;[STARTUP.ASM#155]
SHL EBX,2;[STARTUP.ASM#156]
MOV EAX,EBX;[STARTUP.ASM#157]
SHR EAX,9;[STARTUP.ASM#158]
ADD EAX,[FS:DDPOSFAT];[STARTUP.ASM#159]
CALL LECSECFAT;[STARTUP.ASM#160]
AND BX,1FFH;[STARTUP.ASM#161]
MOV EAX,[ES:BX];[STARTUP.ASM#162]
CMP EAX,0FFFFFF0H;[STARTUP.ASM#163]
JAE NEAR ENDOFFILE;[STARTUP.ASM#164]
JMP GOODCLU;[STARTUP.ASM#165]
CLUFAT16:;[STARTUP.ASM#167]
SHL EBX,1;[STARTUP.ASM#168]
MOV EAX,EBX;[STARTUP.ASM#169]
SHR EAX,9;[STARTUP.ASM#170]
ADD EAX,[FS:DDPOSFAT];[STARTUP.ASM#171]
CALL LECSECFAT;[STARTUP.ASM#172]
AND BX,1FFH;[STARTUP.ASM#173]
MOVZX EAX,[ES:W +BX];[STARTUP.ASM#174]
CMP AX,0FFF0H;[STARTUP.ASM#175]
JAE NEAR ENDOFFILE;[STARTUP.ASM#176]
JMP GOODCLU;[STARTUP.ASM#177]
CLUFAT12:;[STARTUP.ASM#179]
MOV EAX,EBX;[STARTUP.ASM#180]
SHR EAX,1;[STARTUP.ASM#181]
ADD EAX,EBX;[STARTUP.ASM#182]
MOV DI,AX;[STARTUP.ASM#183]
SHR EAX,9;[STARTUP.ASM#184]
ADD EAX,[FS:DDPOSFAT];[STARTUP.ASM#185]
INC DH;[STARTUP.ASM#186]
CALL LECSECFAT;[STARTUP.ASM#187]
AND DI,1FFH;[STARTUP.ASM#188]
MOV AX,[ES:DI];[STARTUP.ASM#189]
TEST BX,1;[STARTUP.ASM#190]
JZ NEAR FAT12_LOW;[STARTUP.ASM#191]
SHR AX,4;[STARTUP.ASM#192]
JMP FAT12_SUITE;[STARTUP.ASM#193]
FAT12_LOW:;[STARTUP.ASM#194]
AND AX,0FFFH;[STARTUP.ASM#195]
FAT12_SUITE:;[STARTUP.ASM#196]
CMP AX,0FF0H;[STARTUP.ASM#197]
JB NEAR GOODCLU;[STARTUP.ASM#198]
ENDOFFILE:;[STARTUP.ASM#199]
XOR EAX,EAX;[STARTUP.ASM#200]
GOODCLU:;[STARTUP.ASM#201]
MOV [FS:DDROOT_CLU],EAX;[STARTUP.ASM#202]
POP ES;[STARTUP.ASM#204]
POPAD;[STARTUP.ASM#205]
RET;[STARTUP.ASM#206]
LECSECFAT:;[STARTUP.ASM#221]
CMP EAX,[FS:OLD_SECTOR_FAT];[STARTUP.ASM#222]
JZ NEAR FINLEC;[STARTUP.ASM#223]
MOV [FS:OLD_SECTOR_FAT],EAX;[STARTUP.ASM#224]
LECSEC:;[STARTUP.ASM#225]
PUSHAD;[STARTUP.ASM#226]
MOV [FS:B +DWINT13_NBRSECTOR],DH;[STARTUP.ASM#228]
MOV [FS:W +DWINT13_OFFSET],0;[STARTUP.ASM#229]
MOV [FS:DWINT13_SEGMENT],ES;[STARTUP.ASM#230]
MOV [FS:DDINT13_SECTOR],EAX;[STARTUP.ASM#231]
MOV SI,[FS:DBINT13_SIZE];[STARTUP.ASM#232]
MOV DL,[FS:DBDRIVE];[STARTUP.ASM#233]
TEST DL,80H;[STARTUP.ASM#234]
JZ NEAR FLOPPY;[STARTUP.ASM#235]
MOV AH,42H;[STARTUP.ASM#236]
INT 13H;[STARTUP.ASM#237]
POPAD;[STARTUP.ASM#238]
FINLEC:;[STARTUP.ASM#239]
RET;[STARTUP.ASM#240]
FLOPPY:;[STARTUP.ASM#241]
MOV BL,[FS:B +DWSEC_PIS];[STARTUP.ASM#242]
PUSH BX;[STARTUP.ASM#243]
SHL BL,1;[STARTUP.ASM#244]
DIV BL;[STARTUP.ASM#245]
MOV CH,AL;[STARTUP.ASM#246]
SHR AX,8;[STARTUP.ASM#248]
POP BX;[STARTUP.ASM#249]
DIV BL;[STARTUP.ASM#250]
XCHG DH,AL;[STARTUP.ASM#251]
MOV CL,AH;[STARTUP.ASM#253]
INC CL;[STARTUP.ASM#254]
MOV AH,02H;[STARTUP.ASM#256]
XOR BX,BX;[STARTUP.ASM#257]
INT 13H;[STARTUP.ASM#258]
POPAD;[STARTUP.ASM#259]
RET;[STARTUP.ASM#260]
AFFAX:;[STARTUP.ASM#290]
PUSH ES;[STARTUP.ASM#291]
MOV BX,0B800H;[STARTUP.ASM#292]
MOV ES,BX;[STARTUP.ASM#293]
XOR DI,DI;[STARTUP.ASM#294]
MOV CX,AX;[STARTUP.ASM#295]
MOV BP,10000;[STARTUP.ASM#296]
DAFFNB2:;[STARTUP.ASM#297]
mov ax,cx;[STARTUP.ASM#297]
XOR DX,DX;[STARTUP.ASM#298]
DIV BP;[STARTUP.ASM#299]
MOV CX,DX;[STARTUP.ASM#300]
ADD AL,48;[STARTUP.ASM#301]
MOV AH,10;[STARTUP.ASM#302]
STOSW;[STARTUP.ASM#303]
MOV AX,BP;[STARTUP.ASM#304]
MOV BP,10;[STARTUP.ASM#305]
XOR DX,DX;[STARTUP.ASM#306]
DIV BP;[STARTUP.ASM#307]
OR AX,AX;[STARTUP.ASM#308]
JZ NEAR QAFFNB2;[STARTUP.ASM#309]
MOV BP,AX;[STARTUP.ASM#310]
JMP DAFFNB2;[STARTUP.ASM#311]
QAFFNB2:;[STARTUP.ASM#312]
XOR AX,AX;[STARTUP.ASM#313]
INT 16H;[STARTUP.ASM#314]
POP ES;[STARTUP.ASM#316]
POPA;[STARTUP.ASM#317]
RET;[STARTUP.ASM#318]
FIN_LIMIT_512 equ offset $-100h;[STARTUP.ASM#320]
IDT:;[STARTUP.ASM#391]
DW 07FFH;[STARTUP.ASM#391]
DD 0800H;[STARTUP.ASM#392]
GDT:;[STARTUP.ASM#394]
DW 07FFH;[STARTUP.ASM#394]
DD 2000H;[STARTUP.ASM#395]
SUITECODE:;[STARTUP.ASM#401]
PUSH BX;[STARTUP.ASM#403]
PUSH DX;[STARTUP.ASM#404]
MOV AX,80H;[STARTUP.ASM#407]
MOV ES,AX;[STARTUP.ASM#408]
XOR EAX,EAX;[STARTUP.ASM#409]
MOV DI,AX;[STARTUP.ASM#410]
MOV ECX,200H;[STARTUP.ASM#411]
REP STOSD;[STARTUP.ASM#412]
MOV AX,200H;[STARTUP.ASM#414]
MOV ES,AX;[STARTUP.ASM#415]
XOR EAX,EAX;[STARTUP.ASM#416]
MOV DI,AX;[STARTUP.ASM#417]
MOV ECX,200H;[STARTUP.ASM#418]
REP STOSD;[STARTUP.ASM#419]
MOV AX,200H;[STARTUP.ASM#422]
MOV ES,AX;[STARTUP.ASM#423]
MOV CX,255;[STARTUP.ASM#424]
XOR DI,DI;[STARTUP.ASM#425]
MOV AX,1;[STARTUP.ASM#426]
LISTGDT:;[STARTUP.ASM#427]
 mov es:[di],ax;[STARTUP.ASM#427]
ADD DI,8;[STARTUP.ASM#428]
INC AX;[STARTUP.ASM#429]
DEC CX;[STARTUP.ASM#430]
JNZ NEAR LISTGDT;[STARTUP.ASM#431]
MOV [ES:W +DI],0;[STARTUP.ASM#432]
MOV EAX,0;[STARTUP.ASM#437]
MOV EBX,0FFFFFH;[STARTUP.ASM#438]
MOV CX,0809BH;[STARTUP.ASM#439]
CALL DESC;[STARTUP.ASM#440]
MOV EAX,0;[STARTUP.ASM#443]
MOV EBX,0FFFFFH;[STARTUP.ASM#444]
MOV CX,08093H;[STARTUP.ASM#445]
CALL DESC;[STARTUP.ASM#446]
MOV EAX,0;[STARTUP.ASM#449]
MOV EBX,0FFFFFH;[STARTUP.ASM#450]
MOV CX,0C09BH;[STARTUP.ASM#451]
CALL DESC;[STARTUP.ASM#452]
MOV EAX,0;[STARTUP.ASM#455]
MOV EBX,0FFFFFH;[STARTUP.ASM#456]
MOV CX,0C093H;[STARTUP.ASM#457]
CALL DESC;[STARTUP.ASM#458]
CALL ENABLEA20;[STARTUP.ASM#463]
CLI;[STARTUP.ASM#466]
lgdt fword ptr cs:[GDT-100h];[STARTUP.ASM#467]
MOV EAX,CR0;[STARTUP.ASM#469]
OR EAX,00000001H;[STARTUP.ASM#470]
MOV CR0,EAX;[STARTUP.ASM#471]
MOV AX,10H;[STARTUP.ASM#473]
MOV ES,AX;[STARTUP.ASM#474]
MOV DS,AX;[STARTUP.ASM#475]
MOV GS,AX;[STARTUP.ASM#476]
MOV FS,AX;[STARTUP.ASM#477]
MOV EAX,CR0;[STARTUP.ASM#480]
AND EAX,7FFFFFFEH;[STARTUP.ASM#481]
MOV CR0,EAX;[STARTUP.ASM#482]
STI;[STARTUP.ASM#484]
POP DX;[STARTUP.ASM#487]
POP BX;[STARTUP.ASM#488]
XOR AX,AX;[STARTUP.ASM#491]
MOV ES,AX;[STARTUP.ASM#492]
MOV DS,AX;[STARTUP.ASM#493]
MOV FS,AX;[STARTUP.ASM#494]
MOV EDI,200000H;[STARTUP.ASM#495]
MOV ESI,3000H;[STARTUP.ASM#497]
MOVZX EBX,BX;[STARTUP.ASM#498]
SHL EBX,4;[STARTUP.ASM#499]
KLOOP:;[STARTUP.ASM#500]
CMP EBX,ESI;[STARTUP.ASM#501]
JZ NEAR EXITKCOPY;[STARTUP.ASM#502]
MOV EAX,[DS:ESI];[STARTUP.ASM#503]
MOV [ES:EDI],EAX;[STARTUP.ASM#504]
ADD ESI,4;[STARTUP.ASM#505]
ADD EDI,4;[STARTUP.ASM#506]
JMP KLOOP;[STARTUP.ASM#507]
EXITKCOPY:;[STARTUP.ASM#508]
OR [FS:D +DDROOT_CLU],0;[STARTUP.ASM#509]
JZ NEAR KFIN;[STARTUP.ASM#510]
MOV AX,300H;[STARTUP.ASM#512]
MOV ES,AX;[STARTUP.ASM#513]
KLECSUITE:;[STARTUP.ASM#514]
CALL ADDRCLU;[STARTUP.ASM#515]
CALL LECSEC;[STARTUP.ASM#516]
MOVZX ECX,DH;[STARTUP.ASM#518]
SHL CX,7;[STARTUP.ASM#519]
XOR ESI,ESI;[STARTUP.ASM#521]
KCOPY:;[STARTUP.ASM#522]
MOV EAX,[ES:ESI];[STARTUP.ASM#523]
MOV [DS:EDI],EAX;[STARTUP.ASM#524]
ADD ESI,4;[STARTUP.ASM#525]
ADD EDI,4;[STARTUP.ASM#526]
LOOP KCOPY;[STARTUP.ASM#527]
CALL CLUSUIVANT;[STARTUP.ASM#530]
OR [FS:D +DDROOT_CLU],0;[STARTUP.ASM#531]
JNZ NEAR KLECSUITE;[STARTUP.ASM#532]
KFIN:;[STARTUP.ASM#533]
CLI;[STARTUP.ASM#539]
lidt fword ptr cs:[IDT-100h];[STARTUP.ASM#540]
lgdt fword ptr cs:[GDT-100h];[STARTUP.ASM#541]
MOV AL,11H;[STARTUP.ASM#544]
OUT 20H,AL;[STARTUP.ASM#545]
JMP $+2;[STARTUP.ASM#546]
OUT 0A0H,AL;[STARTUP.ASM#547]
JMP $+2;[STARTUP.ASM#548]
MOV AL,20H;[STARTUP.ASM#549]
OUT 21H,AL;[STARTUP.ASM#550]
JMP $+2;[STARTUP.ASM#551]
MOV AL,28H;[STARTUP.ASM#552]
OUT 0A1H,AL;[STARTUP.ASM#553]
JMP $+2;[STARTUP.ASM#554]
MOV AL,04H;[STARTUP.ASM#555]
OUT 21H,AL;[STARTUP.ASM#556]
JMP $+2;[STARTUP.ASM#557]
MOV AL,02H;[STARTUP.ASM#558]
OUT 0A1H,AL;[STARTUP.ASM#559]
JMP $+2;[STARTUP.ASM#560]
MOV AL,01H;[STARTUP.ASM#561]
OUT 21H,AL;[STARTUP.ASM#562]
JMP $+2;[STARTUP.ASM#563]
OUT 0A1H,AL;[STARTUP.ASM#564]
JMP $+2;[STARTUP.ASM#565]
MOV AL,11111111B;[STARTUP.ASM#566]
OUT 21H,AL;[STARTUP.ASM#567]
JMP $+2;[STARTUP.ASM#568]
MOV AL,11111111B;[STARTUP.ASM#569]
OUT 0A1H,AL;[STARTUP.ASM#570]
JMP $+2;[STARTUP.ASM#571]
CALL INSTALL_BIOS_INT;[STARTUP.ASM#573]
MOV EAX,1000H;[STARTUP.ASM#577]
MOV CR3,EAX;[STARTUP.ASM#578]
JMP $+2;[STARTUP.ASM#589]
PUSH D 3002H;[STARTUP.ASM#596]
POPFD;[STARTUP.ASM#597]
MOV EAX,CR0;[STARTUP.ASM#600]
OR EAX,00000001H;[STARTUP.ASM#601]
MOV CR0,EAX;[STARTUP.ASM#602]
MOV AX,20H;[STARTUP.ASM#605]
MOV ES,AX;[STARTUP.ASM#606]
MOV DS,AX;[STARTUP.ASM#607]
MOV GS,AX;[STARTUP.ASM#608]
MOV FS,AX;[STARTUP.ASM#609]
MOV SS,AX;[STARTUP.ASM#610]
MOV ESP,200000H;[STARTUP.ASM#611]
DB 66H;[STARTUP.ASM#615]
DB 0EAH;[STARTUP.ASM#616]
OFS_JMP:;[STARTUP.ASM#617]
DD 200000H;[STARTUP.ASM#617]
SEG_JMP:;[STARTUP.ASM#618]
DW 18H;[STARTUP.ASM#618]
AFF_EAX:;[STARTUP.ASM#624]
PUSHAD;[STARTUP.ASM#625]
MOV EDX,EAX;[STARTUP.ASM#626]
XOR BX,BX;[STARTUP.ASM#627]
MOV CL,28;[STARTUP.ASM#628]
AFF_H:;[STARTUP.ASM#629]
MOV EAX,EDX;[STARTUP.ASM#630]
SHR EAX,CL;[STARTUP.ASM#631]
AND EAX,0FH;[STARTUP.ASM#632]
CMP AL,9;[STARTUP.ASM#633]
JA NEAR HEX_CAR;[STARTUP.ASM#634]
ADD AL,48;[STARTUP.ASM#635]
JMP AFF_CAR;[STARTUP.ASM#636]
HEX_CAR:;[STARTUP.ASM#637]
 add al,'A'-10;[STARTUP.ASM#637]
AFF_CAR:;[STARTUP.ASM#638]
MOV AH,0EH;[STARTUP.ASM#639]
INT 10H;[STARTUP.ASM#640]
SUB CL,4;[STARTUP.ASM#641]
JAE NEAR AFF_H;[STARTUP.ASM#642]
MOV AH,0EH;[STARTUP.ASM#644]
MOV AL,'h';[STARTUP.ASM#645]
INT 10H;[STARTUP.ASM#646]
CALL WAIT_KEY;[STARTUP.ASM#648]
CALL WAIT_KEY;[STARTUP.ASM#649]
POPAD;[STARTUP.ASM#650]
RET;[STARTUP.ASM#651]
AFFTXT:;[STARTUP.ASM#654]
MOV AH,0EH;[STARTUP.ASM#655]
XOR BX,BX;[STARTUP.ASM#656]
BCLAFF:;[STARTUP.ASM#657]
LODSB;[STARTUP.ASM#657]
OR AL,AL;[STARTUP.ASM#658]
JNZ NEAR AFF0;[STARTUP.ASM#659]
RET;[STARTUP.ASM#660]
AFF0:;[STARTUP.ASM#661]
 int 10h;[STARTUP.ASM#661]
JMP BCLAFF;[STARTUP.ASM#662]
DESC:;[STARTUP.ASM#666]
PUSH EBX;[STARTUP.ASM#667]
PUSH DI;[STARTUP.ASM#668]
PUSH ES;[STARTUP.ASM#669]
PUSH DX;[STARTUP.ASM#670]
MOV DI,200H;[STARTUP.ASM#671]
MOV ES,DI;[STARTUP.ASM#672]
MOV DI,[ES:0];[STARTUP.ASM#673]
SHL DI,3;[STARTUP.ASM#674]
MOV DX,[ES:DI];[STARTUP.ASM#675]
MOV [ES:0],DX;[STARTUP.ASM#676]
MOV [ES:DI],BX;[STARTUP.ASM#677]
SHR EBX,16;[STARTUP.ASM#678]
OR BL,CH;[STARTUP.ASM#679]
MOV [ES:DI+6],BL;[STARTUP.ASM#680]
MOV [ES:DI+2],AX;[STARTUP.ASM#681]
SHR EAX,16;[STARTUP.ASM#682]
MOV [ES:DI+4],AL;[STARTUP.ASM#683]
MOV [ES:DI+7],AH;[STARTUP.ASM#684]
MOV [ES:DI+5],CL;[STARTUP.ASM#685]
MOV AX,DI;[STARTUP.ASM#686]
POP DX;[STARTUP.ASM#687]
POP ES;[STARTUP.ASM#688]
POP DI;[STARTUP.ASM#689]
POP EBX;[STARTUP.ASM#690]
RET;[STARTUP.ASM#691]
ENABLEA20:;[STARTUP.ASM#694]
PUSHA;[STARTUP.ASM#695]
PUSH FS;[STARTUP.ASM#696]
PUSH GS;[STARTUP.ASM#697]
CLI;[STARTUP.ASM#698]
XOR AX,AX;[STARTUP.ASM#700]
MOV FS,AX;[STARTUP.ASM#701]
DEC AX;[STARTUP.ASM#702]
MOV GS,AX;[STARTUP.ASM#703]
CALL A20TEST;[STARTUP.ASM#705]
JZ NEAR A20FIN;[STARTUP.ASM#706]
IN AL,92H;[STARTUP.ASM#708]
OR AL,2;[STARTUP.ASM#709]
JMP $+2;[STARTUP.ASM#710]
JMP $+2;[STARTUP.ASM#711]
JMP $+2;[STARTUP.ASM#712]
OUT 92H,AL;[STARTUP.ASM#713]
CALL A20TEST;[STARTUP.ASM#715]
JZ NEAR A20FIN;[STARTUP.ASM#716]
CALL A20KBWAIT;[STARTUP.ASM#718]
JNZ NEAR A20F0;[STARTUP.ASM#719]
MOV AL,0D1H;[STARTUP.ASM#721]
OUT 64H,AL;[STARTUP.ASM#722]
CALL A20KBWAIT;[STARTUP.ASM#724]
JNZ NEAR A20F0;[STARTUP.ASM#725]
MOV AL,0DFH;[STARTUP.ASM#727]
OUT 60H,AL;[STARTUP.ASM#728]
CALL A20KBWAIT;[STARTUP.ASM#730]
A20F0:;[STARTUP.ASM#732]
MOV CX,800H;[STARTUP.ASM#733]
A20L0:;[STARTUP.ASM#735]
CALL A20TEST;[STARTUP.ASM#736]
JZ NEAR A20FIN;[STARTUP.ASM#737]
IN AL,40H;[STARTUP.ASM#739]
JMP $+2;[STARTUP.ASM#740]
JMP $+2;[STARTUP.ASM#741]
JMP $+2;[STARTUP.ASM#742]
IN AL,40H;[STARTUP.ASM#743]
MOV AH,AL;[STARTUP.ASM#744]
A20L1:;[STARTUP.ASM#746]
IN AL,40H;[STARTUP.ASM#747]
JMP $+2;[STARTUP.ASM#748]
JMP $+2;[STARTUP.ASM#749]
JMP $+2;[STARTUP.ASM#750]
IN AL,40H;[STARTUP.ASM#751]
CMP AL,AH;[STARTUP.ASM#752]
JE NEAR A20L1;[STARTUP.ASM#753]
LOOP A20L0;[STARTUP.ASM#755]
A20FIN:;[STARTUP.ASM#757]
STI;[STARTUP.ASM#758]
POP GS;[STARTUP.ASM#759]
POP FS;[STARTUP.ASM#760]
POPA;[STARTUP.ASM#761]
RET;[STARTUP.ASM#762]
A20KBWAIT:;[STARTUP.ASM#765]
XOR CX,CX;[STARTUP.ASM#766]
WAITL0:;[STARTUP.ASM#767]
JMP $+2;[STARTUP.ASM#768]
JMP $+2;[STARTUP.ASM#769]
JMP $+2;[STARTUP.ASM#770]
IN AL,64H;[STARTUP.ASM#771]
TEST AL,2;[STARTUP.ASM#772]
LOOPNZ WAITL0;[STARTUP.ASM#773]
RET;[STARTUP.ASM#774]
A20TEST:;[STARTUP.ASM#777]
MOV AL,[FS:0];[STARTUP.ASM#778]
MOV AH,AL;[STARTUP.ASM#779]
NOT AL;[STARTUP.ASM#780]
XCHG AL,[GS:10H];[STARTUP.ASM#781]
CMP AH,[FS:0];[STARTUP.ASM#782]
MOV [GS:10H],AL;[STARTUP.ASM#783]
RET;[STARTUP.ASM#784]
INSTALL_BIOS_INT:;[STARTUP.ASM#787]
PUSH DI;[STARTUP.ASM#789]
PUSH SI;[STARTUP.ASM#790]
PUSH CX;[STARTUP.ASM#791]
PUSH ES;[STARTUP.ASM#792]
PUSH DS;[STARTUP.ASM#793]
XOR AX,AX;[STARTUP.ASM#795]
MOV ES,AX;[STARTUP.ASM#796]
MOV AX,CS;[STARTUP.ASM#797]
MOV DS,AX;[STARTUP.ASM#798]
MOV DI,1000H;[STARTUP.ASM#799]
MOV SI,BEGIN_CALL-100H;[STARTUP.ASM#800]
MOV CX,END_CALL-100H;[STARTUP.ASM#802]
SUB CX,SI;[STARTUP.ASM#803]
ADD CX,2;[STARTUP.ASM#804]
SHR CX,1;[STARTUP.ASM#805]
CMP CX,400H;[STARTUP.ASM#806]
JB NEAR LIMIT_OK2;[STARTUP.ASM#807]
MOV AH,0EH;[STARTUP.ASM#808]
XOR BX,BX;[STARTUP.ASM#809]
MOV AL,'e';[STARTUP.ASM#810]
INT 10H;[STARTUP.ASM#811]
JMP $;[STARTUP.ASM#812]
LIMIT_OK2:;[STARTUP.ASM#813]
REP MOVSW;[STARTUP.ASM#815]
POP DS;[STARTUP.ASM#817]
POP ES;[STARTUP.ASM#818]
POP CX;[STARTUP.ASM#819]
POP SI;[STARTUP.ASM#820]
POP DI;[STARTUP.ASM#821]
RET;[STARTUP.ASM#822]
begin_call_int equ offset $;[STARTUP.ASM#824]
BEGIN_CALL:;[STARTUP.ASM#825]
PUSHAD;[STARTUP.ASM#826]
PUSH DS;[STARTUP.ASM#827]
PUSH ES;[STARTUP.ASM#828]
MOV AX,10H;[STARTUP.ASM#830]
MOV DS,AX;[STARTUP.ASM#831]
MOV ES,AX;[STARTUP.ASM#832]
MOV FS,AX;[STARTUP.ASM#833]
MOV GS,AX;[STARTUP.ASM#834]
MOV WORD [DS:OLD_SS -BEGIN_CALL_INT+1000H],SS;[STARTUP.ASM#836]
MOV DWORD [DS:OLD_ESP -BEGIN_CALL_INT+1000H],ESP;[STARTUP.ASM#837]
sgdt fword ptr ds:[GDT_Isa -begin_call_int+1000h];[STARTUP.ASM#839]
MOV SS,AX;[STARTUP.ASM#841]
MOV ESP,2000H-24;[STARTUP.ASM#842]
POP AX;[STARTUP.ASM#844]
MOV BYTE [DS:NUM_INT -BEGIN_CALL_INT+1000H],AL;[STARTUP.ASM#845]
JMP VIDE_CACHE;[STARTUP.ASM#847]
OLD_SS:;[STARTUP.ASM#849]
DW 0;[STARTUP.ASM#849]
OLD_ESP:;[STARTUP.ASM#850]
DD 0;[STARTUP.ASM#850]
GDT_ISA:;[STARTUP.ASM#852]
DW 07FFH;[STARTUP.ASM#852]
DD 2000H;[STARTUP.ASM#853]
VIDE_CACHE:;[STARTUP.ASM#855]
MOV EAX,CR0;[STARTUP.ASM#857]
AND EAX,7FFFFFFEH;[STARTUP.ASM#858]
MOV CR0,EAX;[STARTUP.ASM#859]
DB 0EAH;[STARTUP.ASM#861]
DW JUMPRM -BEGIN_CALL_INT+1000H;[STARTUP.ASM#862]
DW 0;[STARTUP.ASM#863]
JUMPRM:;[STARTUP.ASM#865]
XOR AX,AX;[STARTUP.ASM#867]
MOV SS,AX;[STARTUP.ASM#868]
POPF;[STARTUP.ASM#870]
POP DS;[STARTUP.ASM#871]
POP ES;[STARTUP.ASM#872]
POPA;[STARTUP.ASM#873]
STI;[STARTUP.ASM#875]
DB 0CDH;[STARTUP.ASM#891]
NUM_INT:;[STARTUP.ASM#892]
DB 0;[STARTUP.ASM#892]
CLI;[STARTUP.ASM#894]
PUSHA;[STARTUP.ASM#896]
PUSH ES;[STARTUP.ASM#897]
PUSH DS;[STARTUP.ASM#898]
PUSHF;[STARTUP.ASM#899]
lgdt fword ptr cs:[GDT_Isa -begin_call_int+1000h];[STARTUP.ASM#901]
MOV EAX,CR0;[STARTUP.ASM#904]
OR EAX,00000001H;[STARTUP.ASM#905]
MOV CR0,EAX;[STARTUP.ASM#906]
DB 0EAH;[STARTUP.ASM#908]
DW JUMPPM -BEGIN_CALL_INT+1000H;[STARTUP.ASM#909]
DW 08H;[STARTUP.ASM#910]
JUMPPM:;[STARTUP.ASM#911]
MOV AX,10H;[STARTUP.ASM#912]
MOV DS,AX;[STARTUP.ASM#913]
MOV SS,WORD [DS:OLD_SS -BEGIN_CALL_INT+1000H];[STARTUP.ASM#915]
MOV ESP,DWORD [DS:OLD_ESP -BEGIN_CALL_INT+1000H];[STARTUP.ASM#916]
FIN_INT:;[STARTUP.ASM#918]
POP ES;[STARTUP.ASM#919]
POP DS;[STARTUP.ASM#920]
POPAD;[STARTUP.ASM#921]
DB 066H;[STARTUP.ASM#923]
RETF;[STARTUP.ASM#924]
END_CALL:;[STARTUP.ASM#925]
AFFBUF_BIOS:;[STARTUP.ASM#933]
PUSHAD;[STARTUP.ASM#934]
PUSH DS;[STARTUP.ASM#935]
MOV ESI,EAX;[STARTUP.ASM#937]
XOR AX,AX;[STARTUP.ASM#938]
MOV DS,AX;[STARTUP.ASM#939]
MOV CX,16;[STARTUP.ASM#940]
AFFBB:;[STARTUP.ASM#941]
PUSH CX;[STARTUP.ASM#942]
MOV AX,SI;[STARTUP.ASM#944]
CALL AFFAX_BIOS;[STARTUP.ASM#945]
XOR BX,BX;[STARTUP.ASM#946]
MOV AH,0EH;[STARTUP.ASM#947]
MOV AL,':';[STARTUP.ASM#948]
INT 10H;[STARTUP.ASM#949]
MOV CX,512;[STARTUP.ASM#951]
AFFBL:;[STARTUP.ASM#952]
MOV AL,[DS:ESI];[STARTUP.ASM#953]
INC ESI;[STARTUP.ASM#954]
CMP AL,32;[STARTUP.ASM#955]
JB NEAR PASSCAR;[STARTUP.ASM#956]
XOR BX,BX;[STARTUP.ASM#958]
MOV AH,0EH;[STARTUP.ASM#959]
INT 10H;[STARTUP.ASM#960]
PASSCAR:;[STARTUP.ASM#961]
LOOP AFFBL;[STARTUP.ASM#962]
XOR BX,BX;[STARTUP.ASM#964]
MOV AH,0EH;[STARTUP.ASM#965]
MOV AL,10;[STARTUP.ASM#966]
INT 10H;[STARTUP.ASM#967]
XOR BX,BX;[STARTUP.ASM#968]
MOV AH,0EH;[STARTUP.ASM#969]
MOV AL,13;[STARTUP.ASM#970]
INT 10H;[STARTUP.ASM#971]
POP CX;[STARTUP.ASM#973]
LOOP AFFBB;[STARTUP.ASM#974]
CALL WAIT_KEY;[STARTUP.ASM#976]
CALL WAIT_KEY;[STARTUP.ASM#977]
POP DS;[STARTUP.ASM#979]
POPAD;[STARTUP.ASM#980]
RET;[STARTUP.ASM#981]
AFFAX_BIOS:;[STARTUP.ASM#985]
PUSHA;[STARTUP.ASM#986]
MOV CX,AX;[STARTUP.ASM#987]
MOV BP,10000;[STARTUP.ASM#988]
XOR BX,BX;[STARTUP.ASM#989]
DAFFNB3:;[STARTUP.ASM#990]
mov ax,cx;[STARTUP.ASM#990]
XOR DX,DX;[STARTUP.ASM#991]
DIV BP;[STARTUP.ASM#992]
MOV CX,DX;[STARTUP.ASM#993]
ADD AL,48;[STARTUP.ASM#994]
MOV AH,0EH;[STARTUP.ASM#995]
INT 10H;[STARTUP.ASM#996]
MOV AX,BP;[STARTUP.ASM#997]
MOV BP,10;[STARTUP.ASM#998]
XOR DX,DX;[STARTUP.ASM#999]
DIV BP;[STARTUP.ASM#1000]
OR AX,AX;[STARTUP.ASM#1001]
JZ NEAR QAFFNB3;[STARTUP.ASM#1002]
MOV BP,AX;[STARTUP.ASM#1003]
JMP DAFFNB3;[STARTUP.ASM#1004]
QAFFNB3:;[STARTUP.ASM#1005]
CALL WAIT_KEY;[STARTUP.ASM#1006]
POPA;[STARTUP.ASM#1007]
RET;[STARTUP.ASM#1008]
WAIT_KEY:;[STARTUP.ASM#1011]
PUSH AX;[STARTUP.ASM#1012]
IN AL,60H;[STARTUP.ASM#1013]
MOV AH,AL;[STARTUP.ASM#1014]
BCLTC:;[STARTUP.ASM#1015]
 in al,60h;[STARTUP.ASM#1015]
CMP AL,AH;[STARTUP.ASM#1016]
JZ NEAR BCLTC;[STARTUP.ASM#1017]
POP AX;[STARTUP.ASM#1018]
RET;[STARTUP.ASM#1019]
ERREUR:;[STARTUP.ASM#1022]
IN AL,60H;[STARTUP.ASM#1023]
MOV AH,AL;[STARTUP.ASM#1024]
BCLTCH:;[STARTUP.ASM#1025]
 in al,60h;[STARTUP.ASM#1025]
CMP AL,AH;[STARTUP.ASM#1026]
JZ NEAR BCLTCH;[STARTUP.ASM#1027]
DB 0EAH;[STARTUP.ASM#1029]
DW 0000;[STARTUP.ASM#1030]
DW 0FFFFH;[STARTUP.ASM#1031]
AFFLINE:;[STARTUP.ASM#1035]
PUSH AX;[STARTUP.ASM#1036]
PUSH BX;[STARTUP.ASM#1037]
PUSH DX;[STARTUP.ASM#1038]
PUSH SI;[STARTUP.ASM#1039]
PUSH DI;[STARTUP.ASM#1040]
PUSH ES;[STARTUP.ASM#1041]
MOV DX,3D4H;[STARTUP.ASM#1043]
MOV AL,0EH;[STARTUP.ASM#1044]
OUT DX,AL;[STARTUP.ASM#1045]
INC DX;[STARTUP.ASM#1046]
IN AL,DX;[STARTUP.ASM#1047]
DEC DX;[STARTUP.ASM#1048]
MOV DI,AX;[STARTUP.ASM#1049]
SHL DI,8;[STARTUP.ASM#1050]
MOV AL,0FH;[STARTUP.ASM#1051]
OUT DX,AL;[STARTUP.ASM#1052]
INC DX;[STARTUP.ASM#1053]
IN AL,DX;[STARTUP.ASM#1054]
XOR AH,AH;[STARTUP.ASM#1055]
OR DI,AX;[STARTUP.ASM#1056]
SHL DI,1;[STARTUP.ASM#1057]
MOV AX,0B800H;[STARTUP.ASM#1059]
MOV ES,AX;[STARTUP.ASM#1060]
MOV AH,BL;[STARTUP.ASM#1061]
AFFLINE00:;[STARTUP.ASM#1062]
LODSB;[STARTUP.ASM#1063]
OR AL,AL;[STARTUP.ASM#1064]
JZ NEAR AFFLINEFIN;[STARTUP.ASM#1065]
CMP AL,10;[STARTUP.ASM#1066]
JNE NEAR AFFLINE01;[STARTUP.ASM#1067]
PUSH AX;[STARTUP.ASM#1068]
MOV AX,DI;[STARTUP.ASM#1069]
XOR DX,DX;[STARTUP.ASM#1070]
MOV BX,160;[STARTUP.ASM#1071]
DIV BX;[STARTUP.ASM#1072]
SUB DI,DX;[STARTUP.ASM#1073]
POP AX;[STARTUP.ASM#1074]
JMP AFFLINE00;[STARTUP.ASM#1075]
AFFLINE01:;[STARTUP.ASM#1076]
CMP AL,13;[STARTUP.ASM#1077]
JNE NEAR AFFLINE02;[STARTUP.ASM#1078]
ADD DI,160;[STARTUP.ASM#1079]
JMP AFFLINE00;[STARTUP.ASM#1080]
AFFLINE02:;[STARTUP.ASM#1081]
CMP AL,9;[STARTUP.ASM#1082]
JNE NEAR AFFLINE03;[STARTUP.ASM#1083]
ADD DI,16;[STARTUP.ASM#1084]
AND DI,0FFF0H;[STARTUP.ASM#1085]
JMP AFFLINE00;[STARTUP.ASM#1086]
AFFLINE03:;[STARTUP.ASM#1087]
CALL TSTECR;[STARTUP.ASM#1088]
STOSW;[STARTUP.ASM#1089]
JMP AFFLINE00;[STARTUP.ASM#1090]
AFFLINEFIN:;[STARTUP.ASM#1092]
CALL TSTECR;[STARTUP.ASM#1093]
SHR DI,1;[STARTUP.ASM#1094]
MOV DX,3D4H;[STARTUP.ASM#1095]
MOV AX,DI;[STARTUP.ASM#1096]
MOV AL,0EH;[STARTUP.ASM#1097]
OUT DX,AX;[STARTUP.ASM#1098]
MOV AX,DI;[STARTUP.ASM#1100]
MOV AH,AL;[STARTUP.ASM#1101]
MOV AL,0FH;[STARTUP.ASM#1102]
OUT DX,AX;[STARTUP.ASM#1103]
POP ES;[STARTUP.ASM#1105]
POP DI;[STARTUP.ASM#1106]
POP SI;[STARTUP.ASM#1107]
POP DX;[STARTUP.ASM#1108]
POP BX;[STARTUP.ASM#1109]
POP AX;[STARTUP.ASM#1110]
RET;[STARTUP.ASM#1111]
TSTECR:;[STARTUP.ASM#1112]
CMP DI,4000;[STARTUP.ASM#1113]
JB NEAR AFFLINE04;[STARTUP.ASM#1114]
PUSH AX;[STARTUP.ASM#1115]
PUSH DS;[STARTUP.ASM#1116]
PUSH SI;[STARTUP.ASM#1117]
PUSH CX;[STARTUP.ASM#1118]
MOV AX,DI;[STARTUP.ASM#1119]
MOV BX,160;[STARTUP.ASM#1120]
XOR DX,DX;[STARTUP.ASM#1121]
DIV BX;[STARTUP.ASM#1122]
SUB AX,24;[STARTUP.ASM#1123]
MOV DI,DX;[STARTUP.ASM#1124]
ADD DI,24*160;[STARTUP.ASM#1125]
MUL BX;[STARTUP.ASM#1126]
MOV SI,AX;[STARTUP.ASM#1127]
PUSH ES;[STARTUP.ASM#1128]
POP DS;[STARTUP.ASM#1129]
PUSH DI;[STARTUP.ASM#1130]
XOR DI,DI;[STARTUP.ASM#1131]
MOV CX,4000;[STARTUP.ASM#1132]
SUB CX,SI;[STARTUP.ASM#1133]
PUSH SI;[STARTUP.ASM#1134]
REP MOVSB;[STARTUP.ASM#1135]
POP SI;[STARTUP.ASM#1136]
MOV CX,SI;[STARTUP.ASM#1137]
SHR CX,1;[STARTUP.ASM#1138]
MOV AX,0720H;[STARTUP.ASM#1139]
REP STOSW;[STARTUP.ASM#1140]
POP DI;[STARTUP.ASM#1141]
POP CX;[STARTUP.ASM#1143]
POP SI;[STARTUP.ASM#1144]
POP DS;[STARTUP.ASM#1145]
POP AX;[STARTUP.ASM#1146]
AFFLINE04:;[STARTUP.ASM#1147]
RET;[STARTUP.ASM#1148]
endp;[STARTUP.ASM#1149]
AFFNB:;[STARTUP.ASM#1153]
PUSH ES;[STARTUP.ASM#1154]
MOV BX,0B800H;[STARTUP.ASM#1155]
MOV ES,BX;[STARTUP.ASM#1156]
XOR DI,DI;[STARTUP.ASM#1157]
MOV CX,AX;[STARTUP.ASM#1158]
MOV BP,10000;[STARTUP.ASM#1159]
XOR BX,BX;[STARTUP.ASM#1160]
DAFFNB:;[STARTUP.ASM#1161]
 mov ax,cx;[STARTUP.ASM#1161]
XOR DX,DX;[STARTUP.ASM#1162]
DIV BP;[STARTUP.ASM#1163]
MOV CX,DX;[STARTUP.ASM#1164]
ADD AL,48;[STARTUP.ASM#1165]
MOV AH,10;[STARTUP.ASM#1166]
STOSW;[STARTUP.ASM#1167]
MOV AX,BP;[STARTUP.ASM#1168]
MOV BP,10;[STARTUP.ASM#1169]
XOR DX,DX;[STARTUP.ASM#1170]
DIV BP;[STARTUP.ASM#1171]
OR AX,AX;[STARTUP.ASM#1172]
JZ NEAR QAFFNB;[STARTUP.ASM#1173]
MOV BP,AX;[STARTUP.ASM#1174]
JMP DAFFNB;[STARTUP.ASM#1175]
QAFFNB:;[STARTUP.ASM#1176]
POPA;[STARTUP.ASM#1177]
RET;[STARTUP.ASM#1178]
OS32 ends;[STARTUP.ASM#1181]
end START;[STARTUP.ASM#1182]
